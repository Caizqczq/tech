# 实施计划

- [x] 1. 创建本地文件存储配置类





  - 创建 LocalFileConfig 配置类，定义存储路径、访问URL等配置项
  - 在 application.yml 中添加本地存储配置
  - 实现配置验证逻辑，确保启动时配置正确
  - _需求: 5.1, 5.2, 5.3, 5.4_

- [x] 2. 实现本地文件工具类





  - 创建 LocalFileUtil 类替换 OssUtil
  - 实现文件上传功能，支持按用户ID和资源类型创建目录结构
  - 实现文件删除、存在性检查等基础操作
  - 实现URL生成功能，返回可访问的HTTP地址
  - _需求: 1.1, 1.2, 1.3, 2.1, 2.2, 2.3, 4.1, 4.2, 4.3_

- [x] 3. 创建文件访问控制器










  - 创建 FileAccessController 提供文件HTTP访问接口
  - 实现文件获取和下载功能
  - 添加用户权限验证，确保用户只能访问自己的文件
  - 实现文件类型检测和安全验证
  - _需求: 3.1, 3.2, 3.3, 3.4_

- [x] 4. 配置静态资源映射





  - 在 WebConfig 中添加静态资源处理器配置
  - 设置文件访问路径映射和缓存策略
  - 配置文件类型的Content-Type处理
  - _需求: 3.1, 3.4_

- [x] 5. 修改资源服务类





  - 更新 ResourceService 中的文件存储逻辑
  - 将 OssUtil 依赖替换为 LocalFileUtil
  - 更新文件路径存储格式，从 ossKey 改为 filePath
  - 确保所有文件操作方法正常工作
  - _需求: 2.1, 2.2, 2.3, 2.4_

- [x] 6. 更新数据库字段映射











  - 修改 TeachingResource 实体类的字段映射
  - 将 ossKey 字段重命名为 filePath 或添加新字段
  - 更新相关的查询和更新操作
  - _需求: 2.1, 2.2_

- [ ] 7. 实现文件存储异常处理
  - 创建自定义异常类 FileStorageException
  - 实现全局异常处理器 FileStorageExceptionHandler
  - 添加详细的错误信息和状态码处理
  - _需求: 1.4, 2.4, 3.2_

- [ ] 8. 编写单元测试
  - 为 LocalFileUtil 编写单元测试，覆盖所有主要功能
  - 为 FileAccessController 编写单元测试
  - 测试文件上传、下载、删除等核心功能
  - 测试异常处理和边界条件
  - _需求: 1.1, 1.2, 1.3, 1.4, 2.1, 2.2, 2.3, 2.4, 3.1, 3.2, 3.3, 3.4_

- [ ] 9. 编写集成测试
  - 测试完整的文件上传到访问流程
  - 测试用户权限验证功能
  - 测试不同文件类型的处理
  - 验证与现有API的兼容性
  - _需求: 2.1, 2.2, 2.3, 3.1, 3.3_

- [x] 10. 更新配置和部署文档





  - 更新 application.yml 配置示例
  - 创建本地存储目录结构说明
  - _需求: 5.1, 5.2, 5.3, 5.4_
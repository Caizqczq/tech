# 需求文档

## 介绍

本功能旨在将后端资源模块从阿里云OSS存储改为本地文件系统存储，提供一个简单、可靠的本地文件存储解决方案。这将减少对外部云服务的依赖，降低成本，并提高文件访问速度。

## 需求

### 需求 1

**用户故事：** 作为系统管理员，我希望能够将文件存储在本地文件系统中，这样我就不需要依赖阿里云OSS服务，可以降低运营成本并提高系统的独立性。

#### 验收标准

1. WHEN 用户上传文件 THEN 系统应将文件保存到本地指定目录
2. WHEN 系统保存文件 THEN 应按照用户ID和资源类型创建目录结构
3. WHEN 文件保存成功 THEN 应生成唯一的文件名避免冲突
4. WHEN 文件保存失败 THEN 应提供清晰的错误信息

### 需求 2

**用户故事：** 作为开发者，我希望本地存储功能能够无缝替换OSS功能，这样现有的API接口和业务逻辑不需要大幅修改。

#### 验收标准

1. WHEN 替换存储方式 THEN 现有的上传、下载、删除API应保持相同的接口
2. WHEN 生成文件访问URL THEN 应返回可直接访问的HTTP URL
3. WHEN 检查文件存在性 THEN 应能正确判断本地文件是否存在
4. WHEN 删除文件 THEN 应能正确删除本地文件

### 需求 3

**用户故事：** 作为系统用户，我希望能够通过HTTP请求直接访问上传的文件，这样我就可以在浏览器中查看或下载文件。

#### 验收标准

1. WHEN 访问文件URL THEN 应能直接下载或查看文件内容
2. WHEN 文件不存在 THEN 应返回404错误
3. WHEN 访问权限验证 THEN 应确保用户只能访问自己的文件
4. WHEN 文件类型为图片或PDF THEN 应能在浏览器中直接预览

### 需求 4

**用户故事：** 作为系统管理员，我希望本地存储的文件能够有良好的组织结构，这样便于管理和维护。

#### 验收标准

1. WHEN 保存文件 THEN 应按照 `/uploads/{userId}/{resourceType}/{filename}` 的目录结构存储
2. WHEN 生成文件名 THEN 应包含时间戳和UUID确保唯一性
3. WHEN 创建目录 THEN 如果目录不存在应自动创建
4. WHEN 文件超过一定数量 THEN 应考虑按日期进一步分组

### 需求 5

**用户故事：** 作为开发者，我希望能够通过配置文件控制本地存储的行为，这样可以灵活调整存储路径和相关参数。

#### 验收标准

1. WHEN 配置存储路径 THEN 应能通过application.yml配置文件设置
2. WHEN 配置文件访问URL前缀 THEN 应能设置访问文件的基础URL
3. WHEN 配置文件大小限制 THEN 应能设置不同类型文件的大小限制
4. WHEN 配置无效 THEN 应在启动时提供清晰的错误提示